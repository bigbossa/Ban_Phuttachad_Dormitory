# ระบบจัดการผู้ใช้และห้องพัก

## ฟีเจอร์การสร้างบัญชีผู้ใช้ใหม่

### การเลือกห้องว่าง

ระบบได้ถูกปรับปรุงให้สามารถสร้างบัญชีผู้ใช้ใหม่ได้เฉพาะห้องที่ไม่มีคนเช่าเลยเท่านั้น

#### ฟีเจอร์หลัก:

1. **การกรองห้องว่าง**: แสดงเฉพาะห้องที่มีสถานะ "vacant" และไม่มีคนเช่า (current_occupants === 0)
2. **การตรวจสอบสถานะห้อง**: ตรวจสอบว่าห้องที่เลือกยังคงว่างอยู่จริงก่อนสร้างบัญชี
3. **การอัปเดตสถานะห้อง**: อัปเดตสถานะห้องเป็น "occupied" หลังจากสร้างบัญชีสำเร็จ

#### การทำงาน:

1. ผู้ดูแลระบบ (admin) เข้าสู่ระบบ
2. เปิดฟอร์มสร้างบัญชีผู้ใช้ใหม่
3. เลือกห้องว่างจากรายการห้องที่ไม่มีคนเช่า
4. กรอกข้อมูลผู้ใช้ (ชื่อ, นามสกุล, อีเมล, รหัสผ่าน, ที่อยู่)
5. ระบบตรวจสอบว่าห้องที่เลือกยังคงว่างอยู่
6. สร้างบัญชีผู้ใช้ใน Supabase Auth
7. เพิ่มข้อมูลผู้เช่าในตาราง tenants
8. เพิ่มข้อมูลการเข้าพักในตาราง occupancy
9. อัปเดตสถานะห้องเป็น "occupied"
10. สร้างและอัปโหลดสัญญาเช่าเป็น PDF

#### ข้อจำกัด:

- สามารถเลือกได้เฉพาะห้องที่ไม่มีคนเช่าเลย
- ห้องที่มีคนเช่าอยู่แล้วจะไม่แสดงในรายการ
- ระบบจะตรวจสอบสถานะห้องอีกครั้งก่อนสร้างบัญชี

#### การแสดงผล:

- แสดงหมายเลขห้อง, ประเภทห้อง, ชั้น, ราคา
- แสดงสถานะ "ว่าง" สำหรับห้องที่เลือกได้
- แสดงข้อความ "ไม่มีห้องว่างที่ไม่มีคนเช่า" เมื่อไม่มีห้องให้เลือก

#### การจัดการข้อมูล:

- อัปเดตข้อมูลห้องทันทีหลังจากสร้างบัญชี
- รีเฟรชข้อมูลห้อง, ผู้เช่า, และการเข้าพัก
- บันทึกประวัติการเข้าพักและสัญญาเช่า

### ไฟล์ที่เกี่ยวข้อง:

- `src/components/auth/UserCreateDialog.tsx` - ฟอร์มสร้างบัญชีผู้ใช้
- `src/providers/LanguageProvider.tsx` - ข้อความภาษาไทย/อังกฤษ
- `src/integrations/supabase/client.ts` - การเชื่อมต่อฐานข้อมูล

### การใช้งาน:

1. เข้าสู่ระบบด้วยบัญชี admin
2. ไปที่เมนูจัดการผู้ใช้
3. คลิก "สร้างบัญชีผู้ใช้ใหม่"
4. เลือกห้องว่างจากรายการ
5. กรอกข้อมูลผู้ใช้
6. ยืนยันและสร้างบัญชี

### หมายเหตุ:

- ฟีเจอร์นี้ใช้เฉพาะผู้ดูแลระบบ (admin) เท่านั้น
- ระบบจะสร้างสัญญาเช่าอัตโนมัติ
- ข้อมูลจะถูกบันทึกในฐานข้อมูล Supabase
- สถานะห้องจะถูกอัปเดตทันที
